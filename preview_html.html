<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todo App</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <style>
body {
  min-height: 100vh;
  background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
  transition: background 0.3s;
}
.card {
  border-radius: 1rem;
}
#todo-input:focus {
  box-shadow: 0 0 0 0.2rem rgba(13,110,253,.25);
}
.list-group-item {
  transition: background 0.2s, box-shadow 0.2s;
  cursor: pointer;
}
.list-group-item.completed {
  text-decoration: line-through;
  color: #adb5bd;
  background: #f1f3f5;
}
.list-group-item:hover {
  background: #f0f4ff;
}
.delete-btn {
  opacity: 0.6;
  transition: opacity 0.2s;
}
.delete-btn:hover {
  opacity: 1;
  color: #dc3545;
}
@media (max-width: 576px) {
  .card {
    border-radius: 0.5rem;
  }
}

/* Dark theme styles */
body.dark-theme {
  background: linear-gradient(135deg, #181a1b 0%, #23272f 100%) !important;
  color: #f1f3f5;
}
body.dark-theme .card {
  background: #23272f;
  color: #f1f3f5;
  border-color: #23272f;
}
body.dark-theme .form-control {
  background: #23272f;
  color: #f1f3f5;
  border-color: #343a40;
}
body.dark-theme .form-control:focus {
  background: #23272f;
  color: #f1f3f5;
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13,110,253,.25);
}
body.dark-theme .list-group-item {
  background: #23272f;
  color: #f1f3f5;
  border-color: #343a40;
}
body.dark-theme .list-group-item.completed {
  background: #23272f;
  color: #6c757d;
}
body.dark-theme .list-group-item:hover {
  background: #232b36;
}
body.dark-theme .btn-outline-danger {
  color: #f87171;
  border-color: #f87171;
}
body.dark-theme .btn-outline-danger:hover {
  background: #f87171;
  color: #fff;
  border-color: #f87171;
}
body.dark-theme .btn-primary {
  background: #0d6efd;
  border-color: #0d6efd;
}
body.dark-theme .btn-outline-secondary {
  color: #f1f3f5;
  border-color: #6c757d;
}
body.dark-theme .btn-outline-secondary:hover {
  background: #6c757d;
  color: #fff;
  border-color: #6c757d;
}
body.dark-theme .text-muted {
  color: #adb5bd !important;
}
body.dark-theme .is-invalid {
  border-color: #dc3545;
}

</style>
</head>
<body class="bg-light" id="main-body">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-7 col-lg-6">
        <div class="card shadow animate__animated animate__fadeIn">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h2 class="card-title text-center mb-0 fw-bold flex-grow-1">Todo App</h2>
              <button id="theme-toggle" class="btn btn-outline-secondary ms-2" title="Toggle light/dark mode">
                <span id="theme-icon" class="bi bi-moon"></span>
              </button>
            </div>
            <form id="todo-form" class="d-flex mb-4">
              <input type="text" id="todo-input" class="form-control me-2" placeholder="Add a new task..." autocomplete="off">
              <button type="submit" class="btn btn-primary">
                <span id="add-spinner" class="spinner-border spinner-border-sm d-none"></span>
                Add
              </button>
            </form>
            <ul id="todo-list" class="list-group mb-3 animate__animated animate__fadeInUp"></ul>
            <div class="d-flex justify-content-between align-items-center">
              <span id="task-count" class="text-muted small"></span>
              <button id="clear-completed" class="btn btn-outline-danger btn-sm">Clear Completed</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
document.addEventListener('DOMContentLoaded', function() {
  const todoForm = document.getElementById('todo-form');
  const todoInput = document.getElementById('todo-input');
  const todoList = document.getElementById('todo-list');
  const taskCount = document.getElementById('task-count');
  const clearCompletedBtn = document.getElementById('clear-completed');
  const addSpinner = document.getElementById('add-spinner');
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = document.getElementById('theme-icon');
  const mainBody = document.getElementById('main-body');

  // Theme logic
  function setTheme(theme) {
    if (theme === 'dark') {
      mainBody.classList.add('dark-theme');
      mainBody.classList.remove('bg-light');
      themeIcon.classList.remove('bi-moon');
      themeIcon.classList.add('bi-sun');
    } else {
      mainBody.classList.remove('dark-theme');
      mainBody.classList.add('bg-light');
      themeIcon.classList.remove('bi-sun');
      themeIcon.classList.add('bi-moon');
    }
  }
  function getPreferredTheme() {
    return localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  }
  function toggleTheme() {
    const current = mainBody.classList.contains('dark-theme') ? 'dark' : 'light';
    const next = current === 'dark' ? 'light' : 'dark';
    setTheme(next);
    localStorage.setItem('theme', next);
  }
  setTheme(getPreferredTheme());
  themeToggle.addEventListener('click', toggleTheme);

  let todos = JSON.parse(localStorage.getItem('todos') || '[]');

  function saveTodos() {
    localStorage.setItem('todos', JSON.stringify(todos));
  }

  function renderTodos() {
    todoList.innerHTML = '';
    if (todos.length === 0) {
      todoList.innerHTML = '<li class="list-group-item text-center text-muted">No tasks yet!</li>';
      taskCount.textContent = '';
      return;
    }
    todos.forEach((todo, idx) => {
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center animate__animated animate__fadeIn';
      if (todo.completed) li.classList.add('completed');
      li.innerHTML = `
        <span class="flex-grow-1" style="user-select: none;">${todo.text}</span>
        <div>
          <button class="btn btn-sm btn-success me-2 complete-btn" title="Mark as ${todo.completed ? 'incomplete' : 'complete'}">
            <i class="bi ${todo.completed ? 'bi-arrow-counterclockwise' : 'bi-check-lg'}"></i>
          </button>
          <button class="btn btn-sm btn-outline-danger delete-btn" title="Delete">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      `;
      // Toggle complete
      li.querySelector('.complete-btn').addEventListener('click', function(e) {
        todos[idx].completed = !todos[idx].completed;
        saveTodos();
        renderTodos();
      });
      // Delete
      li.querySelector('.delete-btn').addEventListener('click', function(e) {
        li.classList.remove('animate__fadeIn');
        li.classList.add('animate__fadeOutLeft');
        setTimeout(() => {
          todos.splice(idx, 1);
          saveTodos();
          renderTodos();
        }, 400);
      });
      // Toggle complete by clicking on text
      li.querySelector('span').addEventListener('click', function() {
        todos[idx].completed = !todos[idx].completed;
        saveTodos();
        renderTodos();
      });
      todoList.appendChild(li);
    });
    const activeCount = todos.filter(t => !t.completed).length;
    taskCount.textContent = `${activeCount} task${activeCount !== 1 ? 's' : ''} left`;
  }

  todoForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const value = todoInput.value.trim();
    if (!value) {
      todoInput.classList.add('is-invalid');
      setTimeout(() => todoInput.classList.remove('is-invalid'), 1200);
      return;
    }
    addSpinner.classList.remove('d-none');
    setTimeout(() => {
      todos.unshift({ text: value, completed: false });
      saveTodos();
      renderTodos();
      todoInput.value = '';
      addSpinner.classList.add('d-none');
      todoInput.focus();
    }, 400);
  });

  clearCompletedBtn.addEventListener('click', function() {
    todos = todos.filter(t => !t.completed);
    saveTodos();
    renderTodos();
  });

  renderTodos();
});

</script>
<div id="root"></div>
</body>
</html>
